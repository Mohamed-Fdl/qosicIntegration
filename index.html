<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Card Integration</title>
</head>
<style>
    .invisible {
        display: none;
    }
</style>

<body>
    <div class="container">
        <h2 class="pt-2 pb-1">Pay using card</h2>
        <div class="alert alert-success invisible" id="success" role="alert">
            Opération successfully executed. Thanks!!
        </div>
        <div class="alert alert-danger invisible" id="error" role="alert">
            An error occured. Retry please!!
        </div>
        <form class="pt-3">
            <div class="form-group">
                <label for="name"><Nav>Firstname</Nav></label>
                <input type="text" class="form-control form-control-sm" id="firstname">
            </div>
            <div class="form-group">
                <label for="firstname"><Nav>Lastname</Nav></label>
                <input type="text" class="form-control form-control-sm" id="lastname">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="civility">Civility</label>
                </div>
                <select class="custom-select form-control-sm" id="title">
                    <option value="Mr">Mr</option>
                    <option value="Mme">Mme</option>
                </select>
            </div>
            <div class="form-group">
                <label for="adress"><Nav>Adress</Nav></label>
                <input type="text" class="form-control form-control-sm" id="adress">
            </div>
            <div class="form-group">
                <label for="locality"><Nav>Locality</Nav></label>
                <input type="text" class="form-control form-control-sm" id="locality">
            </div>
            <div class="form-group">
                <label for="email"><Nav>Email</Nav></label>
                <input type="email" class="form-control form-control-sm" id="email" placeholder="johndoe@gmail.com">
            </div>
            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="text" class="form-control form-control-sm" id="phone" placeholder="+22990000000">
            </div>
            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="number" class="form-control form-control-sm" id="amount" placeholder="5000 XOF">
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary mb-2" id="submit">Pay</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- <button onclick="sendRequest()" id="payButton "> Payé</button> -->

    <script>
        function generateUUID() { // Public Domain/MIT
            var d = new Date().getTime(); //Timestamp
            var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now() * 1000)) || 0; //Time in microseconds since page-load or 0 if unsupported
            return 'xxxxxxxx-xxxx-4xxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16; //random number between 0 and 16
                if (d > 0) { //Use timestamp until depleted
                    r = (d + r) % 16 | 0;
                    d = Math.floor(d / 16);
                } else { //Use microseconds since page-load if supported
                    r = (d2 + r) % 16 | 0;
                    d2 = Math.floor(d2 / 16);
                }
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        const success = document.getElementById('success')

        const error = document.getElementById('error')

        const submit = document.getElementById('submit')

        submit.addEventListener('click', (e) => {
            e.preventDefault()

            var lastname = document.getElementById('lastname').value

            var firstname = document.getElementById('firstname').value

            var civility = document.getElementById('civility')

            var adress = document.getElementById('adress').value

            var locality = document.getElementById('locality').value

            var email = document.getElementById('email').value

            var phone = document.getElementById('phone').value

            var amount = document.getElementById('amount').value


            var data = {
                "type": "all", // in checkout value is mobile/card/all ==> m
                "transref": generateUUID(), // transref ===> m et unique
                "qosKey": "QCBJ001", // is provided by qos platform  ==> m
                "returnUrl": "http://localhost:5500/success.html", // is callback redirection with parameter transref ans status ==> m
                "amountDetails": {
                    "totalAmount": amount, // amount wil be pay by customer //  ==> m
                    "currency": "XOF"
                },
                "saleDetails": {
                    "firstName": firstname, // m
                    "lastName": lastname, // m
                    "title": civility, // m
                    "address1": adress, // m
                    "locality": locality, // m
                    "postalCode": "229", // m
                    "country": "Benin", // m
                    "district": "Bj", // m
                    "email": email, // m
                    "phoneNumber": phone, // m
                    "phoneType": "cel" // m 
                }
            }
            fetch("http://74.208.84.251:9014/public/v1/initTransaction", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(res => {
                    console.log(res)

                    window.location.href = res.url
                }).catch((err) => console.log(err));

        })



        // sendRequest()
        //qoskey
    </script>

</body>

</html>